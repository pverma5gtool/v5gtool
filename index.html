<!DOCTYPE html>
<html>
<head>
  <title>Verana Theoretical Throughput Calculator</title>
  <style>
body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #f6f8fc, #dfe7f2); /* Replace with desired gradient colors */
      padding: 20px;
      text-align: center; /* Center-align the content */
    }

    .container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      text-align: center;
      margin-top: 20px;
    }

       body::before,
    body::after {
      content: "";
      position: absolute;
      top: 0;
      bottom: 0;
      width: 50%; /* Set width for each background image */
      z-index: -1;
    }

      body::before {
      content: "";
      position: fixed; /* Use fixed positioning */
      top: 40%; /* Position the image at 50% from the top */
      left: 0%; /* Position the image at the left side of the viewport */
      width: 50%;
      height: 60vh; /* Use 100vh to cover the entire viewport height */
      z-index: -1;
      background-image: url(images/tbs3.PNG); /* Replace with the left background image URL */
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }
    body::after {
      right: 0;
      background-image: url(right-background-image.jpg); /* Replace with the right background image URL */
      background-size: cover;
      background-position: center;
    }

    .container {
      display: flex;
      justify-content: flex-end; /* Align forms to the right */
      align-items: flex-start;
      text-align: center;
      margin-top: 20px;
    }


    .logo {
      width: 400px;
      margin-bottom: 20px; /* Add margin to create space below the logo */
    }
    .form-section {
      flex-basis: 20%;
      background-color: #fff;
      padding: 20px;
      margin: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      position: relative; /* Add position:relative to allow z-index to work properly */
    }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
      color: #666;
    }

    input[type="number"],
    input[type="text"],
    select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    input[type="submit"] {
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .result {
      margin-top: 20px;
      font-weight: bold;
    }

    .error-message {
      color: red;
      font-weight: bold;
    }

    img.logo {
      width: 200px;
    }

    h1 {
      color: #4CAF50;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
   <img src="images/verana.jfif" alt="Background Image" class="background-image">
  <img src="images/logo.PNG" alt="Logo">
  <h1 style="text-align: center;">Verana Theoretical Throughput Calculator</h1>
  <div class="container">
    <div class="form-section">
      <h2>Downlink Configuration</h2>
      <form id="downlinkForm">
        <div class="form-group">
          <label for="layer">Number of Layers:</label>
          <input type="number" id="layer" name="layer" min="1" max="2" value="1" required>		  
        </div>
		
         <div class="form-group">
          <label for="numcc">Number of CC:</label>
          <input type="number" id="numcc" name="numcc" min="1" max="4" value="2" required>
        </div>

         <div class="form-group">
          <label for="numpanel">Number of panel:</label>
          <input type="number" id="numpanel" name="numpanel" min="1" max="4" value="1" required>
        </div>		

         <div class="form-group">
          <label for="numwb">Number of wide beam:</label>
          <input type="number" id="numwb" name="numwb" min="1" max="10" value="5" required>
        </div>	
		
		<div class="form-group">
          <label for="numnb">Number of narrow beam:</label>
          <input type="number" id="numnb" name="numnb" min="1" max="62" value="31" required>
        </div>	
		
        <div class="form-group">
          <label for="pdschMappingType">PDSCH Mapping Type:</label>
          <select id="pdschMappingType" name="pdschMappingType" required>
            <option value="A">A</option>
            <option value="B">B</option>
          </select>
        </div>
		
		<div class="form-group">
          <label for="dciFormat">DCI Format:</label>
           <select id="dciFormat" name="dciFormat" required>
            <option value="10">10</option>
            <option value="11" selected>11</option>
          </select>
        </div>
       
		
        <div class="form-group">
          <label for="dlota_or_vpal">IS OTA?</label>
		  <select id="dlota_or_vpal" name="dlota_or_vpal" required>
            <option value="YES">YES</option>
            <option value="NO">NO</option>
          </select>
        </div>
		
        <div class="form-group">
          <label for="mcsIndex">MCS Index:</label>
          <input type="number" id="mcsIndex" name="mcsIndex" min="0" max="28" value="28" required>
        </div>

        <div class="form-group">
          <label for="numRb">Number of RBs:</label>
          <input type="number" id="numRb" name="numRb" min="1" max="66" value="66" required>
        </div>

       <div class="form-group">
          <label for="numdlUe">Num MT User:</label>
          <input type="number" id="numdlUe" name="numdlUe" min="1" max="32"  value="1" required>
       </div>
	<div class="form-group">
          <label for="numdlUecpe">Num CPE User:</label>
          <input type="number" id="numdlUecpe" name="numdlUecpe" min="1" max="32"  value="1" required>
       </div>
	   
        <div class="form-group">
          <label for="modulationScheme">Modulation Scheme:</label>
          <select id="modulationScheme" name="modulationScheme" required>
            <option value="64QAM">64QAM</option>
            <option value="256QAM">256QAM</option>
          </select>
        </div>

        <input type="submit" value="Calculate">
      </form>
      <div id="downlinkResult" class="result"></div>
    </div>
    <div class="form-section">
      <h2>Uplink Configuration</h2>
      <form id="uplinkForm">
        <div class="form-group">
          <label for="uplinkLayer">Number of Layers:</label>
          <input type="number" id="uplinkLayer" name="uplinkLayer" min="1" max="2" value="1" required>
        </div>
	      
         <div class="form-group">
          <label for="ulnumpanel">Number of panel:</label>
          <input type="number" id="ulnumpanel" name="ulnumpanel" min="1" max="4" value="1" required>
        </div>	
	      
        <div class="form-group">
          <label for="uplinkMappingType">PUSCH Mapping Type:</label>
          <select id="uplinkMappingType" name="uplinkMappingType" required>
            <option value="A">A</option>
            <option value="B">B</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="uplinkDciFormat">DCI Format:</label>
          <select id="uplinkDciFormat" name="uplinkDciFormat" required>
            <option value="00">00</option>
            <option value="01">01</option>
          </select>
        </div>

        <div class="form-group">
          <label for="pusch_sym">PUSCH SYMBOL</label>
		  <select id="pusch_sym" name="pusch_sym" required>
            <option value="13">13</option>
            <option value="12">12</option>
          </select>
        </div>
	<div class="form-group">
          <label for="single_panle_ota">IS OTA</label>
		  <select id="single_panle_ota" name="single_panle_ota" required>
            <option value="YES">YES</option>
            <option value="NO">NO</option>
          </select>
        </div>

        <div class="form-group">
          <label for="prachCfgIndex">PRACHCFGINDEX</label>
		  <select id="prachCfgIndex" name="prachCfgIndex" required>
            <option value="180">180</option>
            <option value="4">4</option>
          </select>
        </div>
		
        <div class="form-group">
          <label for="uplinkMcsIndex">MCS Index:</label>
          <input type="number" id="uplinkMcsIndex" name="uplinkMcsIndex" min="0" max="28" value="28" required>
        </div>

        <div class="form-group">
          <label for="uplinkNumRb">Number of RBs:</label>
          <input type="number" id="uplinkNumRb" name="uplinkNumRb" min="1" max="66"  value="66" required>
        </div>

        <div class="form-group">
          <label for="ulnumuser">Num UL User:</label>
          <input type="number" id="ulnumuser" name="ulnumuser" min="1" max="32"  value="1" required>
       </div>
		
        <div class="form-group">
          <label for="uplinkModulationScheme">Modulation Scheme:</label>
          <select id="uplinkModulationScheme" name="uplinkModulationScheme" required>
            <option value="64QAM">64QAM</option>
            <option value="256QAM">256QAM</option>
          </select>
        </div>

        <div class="form-group">
          <label for="uplinkFreqHopFlag">Frequency Hop Flag:</label>
          <input type="text" id="uplinkFreqHopFlag" name="uplinkFreqHopFlag" value="Disabled" disabled>
        </div>

        <input type="submit" value="Calculate">
      </form>
      <div id="uplinkResult" class="result"></div>
    </div>
  </div>

  <script>
    function calculateDownlinkThroughput() {
      const layer = parseInt(document.getElementById('layer').value);
      const mappingType = document.getElementById('pushMappingType').value;
      const dciFormat = document.getElementById('dciFormat').value;
      const dmrsLength = parseInt(document.getElementById('dmrsLength').value);
      const mcsIndex = parseInt(document.getElementById('mcsIndex').value);
      const numRb = parseInt(document.getElementById('numRb').value);
      const modulationScheme = parseInt(document.getElementById('modulationScheme').value);

      const throughput = layer * mappingType * dciFormat * dmrsLength * mcsIndex * numRb * modulationScheme;
      document.getElementById('downlinkResult').innerText = `Downlink Throughput: ${throughput}`;
    }

const TBS_TableA = [
  [0, 2, 120, 0.2344],
  [1, 2, 157, 0.3066],
  [2, 2, 193, 0.3770],
  [3, 2, 251, 0.4902],
  [4, 2, 308, 0.6016],
  [5, 2, 379, 0.7402],
  [6, 2, 449, 0.8770],
  [7, 2, 526, 1.0273],
  [8, 2, 602, 1.1758],
  [9, 2, 679, 1.3262],
  [10, 4, 340, 1.3281],
  [11, 4, 378, 1.4766],
  [12, 4, 434, 1.6953],
  [13, 4, 490, 1.9141],
  [14, 4, 553, 2.1602],
  [15, 4, 616, 2.4063],
  [16, 4, 658, 2.5703],
  [17, 6, 438, 2.5664],
  [18, 6, 466, 2.7305],
  [19, 6, 517, 3.0293],
  [20, 6, 567, 3.3223],
  [21, 6, 616, 3.6094],
  [22, 6, 666, 3.9023],
  [23, 6, 719, 4.2129],
  [24, 6, 772, 4.5234],
  [25, 6, 822, 4.8164],
  [26, 6, 873, 5.1152],
  [27, 6, 910, 5.3320],
  [28, 6, 948, 5.5547]
];

const TBS_TableB = [
  [0, 2, 120, 0.2344],
  [1, 2, 193, 0.377],
  [2, 2, 308, 0.6016],
  [3, 2, 449, 0.877],
  [4, 2, 602, 1.1758],
  [5, 4, 378, 1.4766],
  [6, 4, 434, 1.6953],
  [7, 4, 490, 1.9141],
  [8, 4, 553, 2.1602],
  [9, 4, 616, 2.4063],
  [10, 4, 658, 2.5703],
  [11, 6, 466, 2.7305],
  [12, 6, 517, 3.0293],
  [13, 6, 567, 3.3223],
  [14, 6, 616, 3.6094],
  [15, 6, 666, 3.9023],
  [16, 6, 719, 4.2129],
  [17, 6, 772, 4.5234],
  [18, 6, 822, 4.8164],
  [19, 6, 873, 5.1152],
  [20, 8, 682.5, 5.332],
  [21, 8, 711, 5.5547],
  [22, 8, 754, 5.8906],
  [23, 8, 797, 6.2266],
  [24, 8, 841, 6.5703],
  [25, 8, 885, 6.9141],
  [26, 8, 916.5, 7.1602],
  [27, 8, 948, 7.4063]
];

const TBArray = [
  [1, 24],
  [2, 32],
  [3, 40],
  [4, 48],
  [5, 56],
  [6, 64],
  [7, 72],
  [8, 80],
  [9, 88],
  [10, 96],
  [11, 104],
  [12, 112],
  [13, 120],
  [14, 128],
  [15, 136],
  [16, 144],
  [17, 152],
  [18, 160],
  [19, 168],
  [20, 176],
  [21, 184],
  [22, 192],
  [23, 208],
  [24, 224],
  [25, 240],
  [26, 256],
  [27, 272],
  [28, 288],
  [29, 304],
  [30, 320],
  [31, 336],
  [32, 352],
  [33, 368],
  [34, 384],
  [35, 408],
  [36, 432],
  [37, 456],
  [38, 480],
  [39, 504],
  [40, 528],
  [41, 552],
  [42, 576],
  [43, 608],
  [44, 640],
  [45, 672],
  [46, 704],
  [47, 736],
  [48, 768],
  [49, 808],
  [50, 848],
  [51, 888],
  [52, 928],
  [53, 984],
  [54, 1032],
  [55, 1064],
  [56, 1128],
  [57, 1160],
  [58, 1192],
  [59, 1224],
  [60, 1256],
  [61, 1288],
  [62, 1320],
  [63, 1352],
  [64, 1416],
  [65, 1480],
  [66, 1544],
  [67, 1608],
  [68, 1672],
  [69, 1736],
  [70, 1800],
  [71, 1864],
  [72, 1928],
  [73, 2024],
  [74, 2088],
  [75, 2152],
  [76, 2216],
  [77, 2280],
  [78, 2408],
  [79, 2472],
  [80, 2536],
  [81, 2600],
  [82, 2664],
  [83, 2728],
  [84, 2792],
  [85, 2856],
  [86, 2976],
  [87, 3104],
  [88, 3240],
  [89, 3368],
  [90, 3496],
  [91, 3624],
  [92, 3752],
  [93, 3824]
];

function determineTBS(Ninfo) {
    let tbs_p = 0;
    let low = 0,
        high = 92,
        mid = 0;
    let tbHigh, tbLow, tbMid, tbMibLessThanOne;
    tbHigh = TBArray[high][1];
    tbLow = TBArray[low][1];

    if (Ninfo <= tbLow) {
        tbs_p = tbLow;
    } else if (Ninfo >= tbHigh) {
        tbs_p = tbHigh;
    } else {
        while (low <= high) {
            mid = (low + high) >> 1;
            tbMid = TBArray[mid][1];

            if (tbMid < Ninfo) {
                low = mid + 1;
            } else if (tbMid > Ninfo) {
                tbMibLessThanOne = TBArray[mid - 1][1];
                if (tbMibLessThanOne <= Ninfo) {
                    if (tbMibLessThanOne === Ninfo) {
                        tbs_p = tbMibLessThanOne;
                    } else {
                        tbs_p = TBArray[mid][1];
                    }
                    break;
                } else {
                    high = mid - 1;
                }
            } else if (tbMid === Ninfo) {
                tbs_p = TBArray[mid][1];
                break;
            }
            if (low === high) {
                tbs_p = TBArray[low][1];
                break;
            }
        }
    }

    if (tbs_p === 0) {
        console.error(`TBS ${tbs_p} Ninfo ${Ninfo} low ${low} high ${high} mid ${mid}`);
        process.exit(1);
    }
    return tbs_p;
}

function calculateTransBlockQAM(num_res_per_prb, num_layer, mcs, prb, qam_val) {
    let mcsIndex = 0;
    let prbIndex = 0;
    let R = 0;
    let Nre;
    let numLayer = 0;
    let Ninfo = 0;
    let Ninfo1;

    let n, Cprime;
    let temp;
    let temp1, tbs;

    Nre = num_res_per_prb;
    numLayer = num_layer;
    mcsIndex = mcs;
    prbIndex = prb;
    if (qam_val == 0) { // MCS_TABLE_64_QAM
        R = TBS_TableA[mcsIndex][2] / 1024.0;
        Ninfo = Nre * R * numLayer * TBS_TableA[mcsIndex][1] * prbIndex;

    } else {
        R = TBS_TableB[mcsIndex][2] / 1024.0;
        Ninfo = Nre * R * numLayer * TBS_TableB[mcsIndex][1] * prbIndex;
    }
   console.log("Ninfo",Ninfo);
    if (Ninfo <= 3824)
    {
        if (Math.log2(Ninfo) < 6) {
            n = 3;
        } else {
            temp = Math.floor(Math.log2(Ninfo)) - 6;
            n = temp > 3 ? temp : 3;
        }

        temp = Math.floor(Ninfo >> n);
        temp1 = temp << n;
        Ninfo1 = temp1 > 24 ? temp1 : 24;

        let tbs1 = 0;
        tbs1 = determineTBS(Ninfo1);

        return tbs1 / 8;
    } else
    {

        let temp3 = 0,
            temp4 = 0;
        let a = 0;
        let temp5 = 0,
            temp6 = 0;
        tbs = 0;
        temp3 = Ninfo - 24;

        if (Math.floor(Math.log2(temp3)) > 5) {
            n = Math.floor(Math.log2(temp3)) - 5;
        } else {
            n = 0;
        }
        a = 1 << n;
        temp = Math.round(temp3 / a);
        temp1 = temp << n;
        Ninfo1 = temp1 > 3840 ? temp1 : 3840;
        temp4 = Ninfo1 + 24;

        if (R <= 0.25) {
            temp5 = temp4 / 3816;
            Cprime = Math.ceil(temp5);
            temp6 = temp4 / (8 * Cprime);
            temp = Math.ceil(temp6);
            tbs = 8 * Cprime * temp - 24;
        } else {
            if (Ninfo1 > 8424) {
                temp5 = temp4 / 8424;
                Cprime = Math.ceil(temp5);
                temp6 = temp4 / (8 * Cprime);
                temp = Math.ceil(temp6);
                tbs = 8 * Cprime * temp - 24;
		    console.log("Ninfo",Ninfo, Ninfo1,temp,temp1,temp4,n,temp5,Cprime,temp6,temp);
            } else {
                temp5 = temp4 / 8;
                temp = Math.ceil(temp5);
                tbs = 8 * temp - 24;
            }
        }

        return tbs / 8;
    }
}


function get_dmrs_info(symbol_length, dci_format,pusch_mapping_type, freq_hop_flag) {
    const MAX_NUM_SYMBOL = 14;
    const MAX_DMRS_POS = 4;

    // Define the struct type
    function pusch_dmrs_add_pos_symbols_t() {
        this.num_add_pos_sym = new Array(MAX_DMRS_POS);
    }
    // Create an array of pusch_dmrs_add_pos_symbols_t objects
    const g_pusch_dmrs_add_pos_single_symb_freq_hop_disabled_typeA = new Array(MAX_NUM_SYMBOL);
    for (let i = 0; i < MAX_NUM_SYMBOL; i++) {
        g_pusch_dmrs_add_pos_single_symb_freq_hop_disabled_typeA[i] = new pusch_dmrs_add_pos_symbols_t();
        for (let j = 0; j < MAX_DMRS_POS; j++) {
            g_pusch_dmrs_add_pos_single_symb_freq_hop_disabled_typeA[i].num_add_pos_sym[j] = 0;
        }
    }

    // Set the initial values based on the provided initialization values
    g_pusch_dmrs_add_pos_single_symb_freq_hop_disabled_typeA[7].num_add_pos_sym = [0, 1, 1, 1];
    g_pusch_dmrs_add_pos_single_symb_freq_hop_disabled_typeA[8].num_add_pos_sym = [0, 1, 1, 1];
    g_pusch_dmrs_add_pos_single_symb_freq_hop_disabled_typeA[9].num_add_pos_sym = [0, 1, 2, 2];
    g_pusch_dmrs_add_pos_single_symb_freq_hop_disabled_typeA[10].num_add_pos_sym = [0, 1, 2, 2];
    g_pusch_dmrs_add_pos_single_symb_freq_hop_disabled_typeA[11].num_add_pos_sym = [0, 1, 2, 3];
    g_pusch_dmrs_add_pos_single_symb_freq_hop_disabled_typeA[12].num_add_pos_sym = [0, 1, 2, 3];
    g_pusch_dmrs_add_pos_single_symb_freq_hop_disabled_typeA[13].num_add_pos_sym = [0, 1, 2, 3];

    let dmrs_additional_position;

    if (dci_format == 00) {

        switch (pusch_mapping_type.trim()) {
            case "A":
                //if (freq_hop_flag == 'Disabled') {
                if (freq_hop_flag == 0) {
                    dmrs_additional_position = 2;
                } else {
                    dmrs_additional_position = 1;
                }
                return g_pusch_dmrs_add_pos_single_symb_freq_hop_disabled_typeA[symbol_length - 1].num_add_pos_sym[dmrs_additional_position];

            case "B":
                // Handle case B (code not provided)
                break;
        }
        } else if (dci_format == 01) {
            // Handle dci_format 01 (code not provided)
        }

        // Default case when no matching conditions are met
        return null;
    }


    function calculateUplinkThroughput() {
	
	    const DMRS_TYPE_1_DMRS_SYMBOLS_PER_PRB = 6;
		const NUM_CDM_GROUP = 2;
	    let symbol_length = 0;
		let ul_slot_skip = 25;/*csireport /SR with periodcity 40 ms*/
        let uplinkLayer = parseInt(document.getElementById('uplinkLayer').value);
	const numpanel = parseInt(document.getElementById('ulnumpanel').value);
        const uplinkMappingType = document.getElementById('uplinkMappingType').value;
        const uplinkDciFormat = document.getElementById('uplinkDciFormat').value;
        const pusch_sym = document.getElementById('pusch_sym').value;
	const  single_panle_ota = document.getElementById('single_panle_ota').value;
        const uplinkMcsIndex = parseInt(document.getElementById('uplinkMcsIndex').value);
        const uplinkNumRb = parseInt(document.getElementById('uplinkNumRb').value);
	const prachCfgIndex = parseInt(document.getElementById('prachCfgIndex').value);
	const ulNumUe = parseInt(document.getElementById('ulnumuser').value);
	
        const uplinkModulationScheme = document.getElementById('uplinkModulationScheme').value;
        
		console.log("pverma",uplinkLayer,ulNumUe,prachCfgIndex,uplinkModulationScheme.trim(),numpanel,pusch_sym);
        if (uplinkDciFormat == 00) {
            uplinkLayer = 1;
        }

		/*
	       if((is_ota.trim()) == "YES")
		{
		  symbol_length = 12;
		}
		else
		{
		  symbol_length = 13;
		}*/
	    
	symbol_length = pusch_sym;
        
	if(prachCfgIndex == 180)
	{
	    ul_slot_skip += 50;
        }
        else
        {
            ul_slot_skip += 25;
        }

	if((single_panle_ota.trim()) == "YES")
	{
	   ul_slot_skip += (1000/20);
	}
	else
	{
	   ul_slot_skip += 2*(1000/20);	
	}
	if(numpanel == 2)
	{
	   ul_slot_skip += 3*(1000/20);
	}
        const num_dmrs_add_pos_in_slot_p = get_dmrs_info(symbol_length, uplinkDciFormat, uplinkMappingType.trim(),0);
        const ndmrs = (num_dmrs_add_pos_in_slot_p + 1) * NUM_CDM_GROUP * DMRS_TYPE_1_DMRS_SYMBOLS_PER_PRB;;

        const N_overhead = 6;
        const num_REs_per_prb = (symbol_length * 12) - ndmrs - N_overhead;

        let data_rate;

        if ((uplinkModulationScheme.trim()) == "64QAM") {
            data_rate = calculateTransBlockQAM(num_REs_per_prb, uplinkLayer, uplinkMcsIndex, uplinkNumRb, 0);
        } else {
            data_rate = calculateTransBlockQAM(num_REs_per_prb, uplinkLayer, uplinkMcsIndex, uplinkNumRb, 1);
        }
        console.log("datarate,ul_slot_skip",data_rate,ul_slot_skip)		
        const uplinkThroughput = (data_rate * (1600 - ul_slot_skip) *8)/1000000; // Assuming Mbps unit

        //document.getElementById('uplinkResult').innerText = `Total Uplink cell Throughput: ${uplinkThroughput} Mbps`;
		
	  var table = document.createElement("table");
      var row1 = table.insertRow();
      var cell1 = row1.insertCell();
      var cell2 = row1.insertCell();
      var row2 = table.insertRow();
      var cell3 = row2.insertCell();
      var cell4 = row2.insertCell();
	  
      cell1.innerHTML = "Total Uplink cell Throughput";
      cell2.innerHTML = uplinkThroughput;
	  if(pusch_sym == 12)
	  {
       cell3.innerHTML = "SLIV (0,12)Tbs";
	   cell4.innerHTML = data_rate;
	  }
	  else
	  {
	   cell3.innerHTML = "SLIV (0,13)Tbs";
	   cell4.innerHTML = data_rate;
	  }
   
       row1.style.backgroundColor = "#f2f2f2"; // Set background color
       row2.style.backgroundColor = "#e6e6e6"; // Set background color
       cell1.style.paddingLeft = "10px"; // Set indentation
       cell3.style.paddingLeft = "10px"; // Set indentation	  
	  var tableContainer = document.getElementById("uplinkResult");
      tableContainer.appendChild(table);
    }


function get_dl_dmrs_info(symbol_length, dci_format,pdsch_mapping_type, dmrs_additional_position, dmrs_len) 
{
    const MAX_NUM_SYMBOL = 14;
    const MAX_DMRS_POS = 4;

    function pusch_dmrs_add_pos_symbols_t() {
        this.num_add_pos_sym = new Array(MAX_DMRS_POS);
    }

    const g_pdsch_dmrs_add_pos_single_symb_typeA = new Array(MAX_NUM_SYMBOL);
    for (let i = 0; i < MAX_NUM_SYMBOL; i++) {
        g_pdsch_dmrs_add_pos_single_symb_typeA[i] = new pusch_dmrs_add_pos_symbols_t();
        for (let j = 0; j < MAX_DMRS_POS; j++) {
            g_pdsch_dmrs_add_pos_single_symb_typeA[i].num_add_pos_sym[j] = 0;
        }
    }

    g_pdsch_dmrs_add_pos_single_symb_typeA[7].num_add_pos_sym = [0, 1, 1, 1];
    g_pdsch_dmrs_add_pos_single_symb_typeA[8].num_add_pos_sym = [0, 1, 1, 1];
    g_pdsch_dmrs_add_pos_single_symb_typeA[9].num_add_pos_sym = [0, 1, 2, 2];
    g_pdsch_dmrs_add_pos_single_symb_typeA[10].num_add_pos_sym = [0, 1, 2, 2];
    g_pdsch_dmrs_add_pos_single_symb_typeA[11].num_add_pos_sym = [0, 1, 2, 3];
    g_pdsch_dmrs_add_pos_single_symb_typeA[12].num_add_pos_sym = [0, 1, 2, 3];
    g_pdsch_dmrs_add_pos_single_symb_typeA[13].num_add_pos_sym = [0, 1, 2, 3];

    if (dci_format == 01) {

        switch (pdsch_mapping_type.trim()) 
		{
            case "A":            
               return g_pdsch_dmrs_add_pos_single_symb_typeA[symbol_length - 1].num_add_pos_sym[dmrs_additional_position];
            case "B":
                // Handle case B (code not provided)
                break;
        }
    } 		
    else if (dci_format == 11) 
    {
	       switch (pdsch_mapping_type.trim()) 
		{
            case "A":            
               return g_pdsch_dmrs_add_pos_single_symb_typeA[symbol_length - 1].num_add_pos_sym[dmrs_additional_position];
            case "B":
                // Handle case B (code not provided)
            break;
		}
    }
        // Default case when no matching conditions are met
        return null;
}
	
     function calculateDownlinkThroughput() 
	 {
	    let symbol_length = 0;
		let start_symbol = 0;
		let pdsch_length = 0;
		let dl_slot_skip = 0;
		let num_dmrs_add_pos_in_slot = 0;
        let numLayer = parseInt(document.getElementById('layer').value);
		const numcc  = parseInt(document.getElementById('numcc').value);
		const numpanel = parseInt(document.getElementById('numpanel').value);
		const numwb = parseInt(document.getElementById('numwb').value);
		const numnb = parseInt(document.getElementById('numnb').value);
        const pdschMappingType = document.getElementById('pdschMappingType').value;
        const dciFormat = document.getElementById('dciFormat').value;
        const dlota_or_vpal = document.getElementById('dlota_or_vpal').value;
        const mcsIndex = parseInt(document.getElementById('mcsIndex').value);
        const numRb = parseInt(document.getElementById('numRb').value);  
	const numdlUe = parseInt(document.getElementById('numdlUe').value);
	const numdlUecpe parseInt(document.getElementById('ulnumuser').value);
		const modulationScheme = document.getElementById('modulationScheme').value;
		
		let downlinkThroughput = 0;
		const DMRS_TYPE_1_DMRS_SYMBOLS_PER_PRB = 6;
		const NUM_CDM_GROUP = 2;
		var  slivUsedLenght = [13,12,13];
		var  slivUsedstart = [1,2,1];
		var allDslottpt = new Array(); 
		var allSlivTbs = new Array(); 
		
             		
        if (dciFormat == 10) {
		
            numLayer = 1;
        }


		
		for(var i = 0; i < 3 ; i++)
		{
		
		start_symbol = slivUsedstart[i];
		if((dlota_or_vpal.trim()) == "YES")
		{
		  pdsch_length = (slivUsedLenght[i] - 1);
		 
		}
		else
		{
		   pdsch_length = slivUsedLenght[i]; 
		}
		symbol_length = pdsch_length + start_symbol;
		       		
		if(dciFormat == 10)
		{
            num_dmrs_add_pos_in_slot = get_dl_dmrs_info(symbol_length, dciFormat, pdschMappingType.trim(), 2 , 1);			
		}
		else
		{
		   num_dmrs_add_pos_in_slot = get_dl_dmrs_info(symbol_length, dciFormat, pdschMappingType.trim(), 0 , 1);	   
		}
        const ndmrs = (num_dmrs_add_pos_in_slot + 1) * NUM_CDM_GROUP * DMRS_TYPE_1_DMRS_SYMBOLS_PER_PRB;
        
        const N_overhead = 6;
        const num_REs_per_prb = (pdsch_length * 12) - ndmrs - N_overhead;
		       
        let data_rate;

         if ((modulationScheme.trim()) == "64QAM") {
            data_rate = calculateTransBlockQAM(num_REs_per_prb, numLayer, mcsIndex, numRb, 0);
        } else {
            data_rate = calculateTransBlockQAM(num_REs_per_prb, numLayer, mcsIndex, numRb, 1);
        }
         allSlivTbs[i] = data_rate;
         downlinkThroughput = (data_rate * /*(4800 - dl_slot_skip)*/ 8)/1000000; // Assuming Mbps unit
		 allDslottpt[i] = downlinkThroughput;
		 console.log("pverma",pdsch_length,start_symbol,num_dmrs_add_pos_in_slot,ndmrs,num_REs_per_prb,data_rate,downlinkThroughput);
		}
		
		downlinkThroughput = allDslottpt[0]*1600+ allDslottpt[1]*1600 + allDslottpt[2]*1600;
		//if(numpanel == 1)
		{
		  dl_slot_skip += ((Math.ceil((numnb/4)))*(1000/80)); // 1 port csi-rs SLOT	
		  console.log("1port",dl_slot_skip,downlinkThroughput);
		  dl_slot_skip += numwb*(1000/20); //ssb slot
		 if(numdlUecpe)
		 {
			dl_slot_skip += (1000/20);
		 }
		  console.log("ssb",dl_slot_skip);
		  //dl_slot_skip += numwb*(1000/80); //sib1 slot
			
		  dl_slot_skip += numwb*(1000/20); //sib1 slot	
			console.log("sib1",dl_slot_skip);
        }
        if(numpanel == 2)
        {
           dl_slot_skip *= 2;
        }
		
		downlinkThroughput = downlinkThroughput - dl_slot_skip*allDslottpt[0];
		dl_slot_skip = 0;
		dl_slot_skip = (Math.ceil((numdlUe + numdlUecpe)/4))*(1000/40); /*2 port csi-rs */
		 console.log("2 port",dl_slot_skip,downlinkThroughput);
		downlinkThroughput = downlinkThroughput - dl_slot_skip*allDslottpt[1];
		
		downlinkThroughput = numcc*downlinkThroughput;

		//console.log("pverma",numLayer,numcc,numpanel,numwb,numnb,pdschMappingType,dciFormat,dlota_or_vpal.trim(),mcsIndex,numRb,numdlUe,modulationScheme,num_dmrs_add_pos_in_slot,ndmrs,num_REs_per_prb,data_rate,downlinkThroughput);	
       
	   // Create a table and populate it with the data
      var table = document.createElement("table");
      var row1 = table.insertRow();
      var cell1 = row1.insertCell();
      var cell2 = row1.insertCell();
      var row2 = table.insertRow();
      var cell3 = row2.insertCell();
      var cell4 = row2.insertCell();
	  var row3 = table.insertRow();
      var cell5 = row3.insertCell();
      var cell6 = row3.insertCell();
	  var row4 = table.insertRow();
      var cell7 = row4.insertCell();
      var cell8 = row4.insertCell();

      cell1.innerHTML = "Total Downlink cell Throughput";
      cell2.innerHTML = downlinkThroughput;
	  if((dlota_or_vpal.trim()) == "YES")
	  {
      cell3.innerHTML = "1st D slot tbs(sliv 1,12)";
	  cell4.innerHTML = allSlivTbs[0];
	  cell5.innerHTML = "2nd D slot tbs(sliv 2,11)";
	  cell6.innerHTML = allSlivTbs[1];
	  cell7.innerHTML = "3rd D slot tbs(sliv 1,12)";
	  cell8.innerHTML = allSlivTbs[2];
	  }
	  else
	  {
	  cell3.innerHTML = "1st D slot tbs(sliv 1,13)";
	  cell4.innerHTML = allSlivTbs[0];
	  cell5.innerHTML = "2nd D slot tbs(sliv 2,12)";
	  cell6.innerHTML = allSlivTbs[1];
	  cell7.innerHTML = "3rd D slot tbs(sliv 1,13)";
	  cell8.innerHTML = allSlivTbs[2];
	  }
   
       row1.style.backgroundColor = "#f2f2f2"; // Set background color
       row2.style.backgroundColor = "#e6e6e6"; // Set background color
	   row3.style.backgroundColor = "#f2f2f2"; // Set background color
       row4.style.backgroundColor = "#e6e6e6"; // Set background color
       cell1.style.paddingLeft = "10px"; // Set indentation
       cell3.style.paddingLeft = "10px"; // Set indentation
	   cell5.style.paddingLeft = "10px"; // Set indentation
       cell7.style.paddingLeft = "10px"; // Set indentation
	   
	  
      //document.getElementById('downlinkResult').innerText = `Total Downlink cell Throughput: ${downlinkThroughput}`;
	  
	  var tableContainer = document.getElementById("downlinkResult");
      tableContainer.appendChild(table);
		
    }
	
    document.getElementById('downlinkForm').addEventListener('submit', function (event) {
      event.preventDefault();
      calculateDownlinkThroughput();
    });

    document.getElementById('uplinkForm').addEventListener('submit', function (event) {
      event.preventDefault();
      calculateUplinkThroughput();
    });
  </script>
</body>
</html>
